## memory cache & disk cache

缓存分为 memory cache 和 disk cache

|          | memory cache                       | disk cache                 |
| -------- | ---------------------------------- | -------------------------- |
| 相同     | 只能存储一些派生类资源文件         | 只能存储一些派生类资源文件 |
| 不同     | 退出进程时数据会被清除             | 退出进程时数据不会被清除   |
| 储存资源 | 一般脚本、字体、图片会存在内存当中 | css                        |

三级缓存原理 (访问缓存优先级)

- 先在内存中查找,如果有,直接加载。
- 如果内存中不存在,则在硬盘中查找,如果有直接加载。
- 如果硬盘中也没有,那么就进行网络请求。
- 请求获取的资源缓存到硬盘和内存

那么 怎么判断何时从本地找资源,何时请求网络呢?

## HTTP 请求 Header

|               | 参数     | 说明                       | 效果                                |
| ------------- | -------- | -------------------------- | ----------------------------------- |
| Expires       | GMT      | 绝对时间                   | 指定过期时间,过了指定时间就判断过期 |
| Cache-Control | max-age  | 相对时间                   | max-age=3600,3600 秒后过期          |
|               | no-cache | 协商缓存                   | 请求到服务器确认是否使用缓存        |
|               | no-store | 禁止使用缓存               | 每次都要重新请求                    |
|               | public   | 可以被所有的用户缓存       | 请求到服务器确认是否使用缓存        |
|               | private  | 只能被终端用户的浏览器缓存 | 请求到服务器确认是否使用缓存        |

Cache-Control 优先级比 Expirse 高

|                 | 参数                       | 说明 | 效果 |
| --------------- | -------------------------- | ---- | ---- |
| Last-Modify     | 标识该资源的最后修改时间   |      |      |
| If-Modify-Since | 缓存之前返回的 Last-Modify |      |      |

缺点
周期性变化,如果这个资源在一个周期内修改回原来的样子了，我们认为是可以使用缓存的，但是 Last-Modified 可不这样认为,因此便有了 ETag

|               | 参数             | 说明 | 效果 |
| ------------- | ---------------- | ---- | ---- |
| ETag          | 文件校验码       |      |      |
| If-None-Match | 之前返回的检验码 |      |      |

Last-Modified 与 ETag 是可以一起使用的，服务器会优先验证 ETag，一致的情况下，才会继续比对 Last-Modified，最后才决定是否返回 304

> Etag 改变文件一定会改变吗

不一定，由服务器中 ETag 的生成算法决定
比如 nginx 中的 etag 由 last_modified 与 content_length 组成，而 last_modified 又由 mtime 组成
当编辑文件却未更改文件内容时，mtime 也会改变，此时 etag 改变，但是文件内容没有更改。

> 文件系统中 mtime 和 ctime 指什么，都有什么不同

mtime：modified time 指文件内容改变的时间戳
ctime：change time 指文件属性改变的时间戳，属性包括 mtime。而在 windows 上，它表示的是 creation time
